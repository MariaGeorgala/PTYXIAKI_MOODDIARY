{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="profile-wrapper mood-{{ current_mood }}">
  <div class="profile-card">

    <!-- HEADER -->
    <div class="profile-header">
      <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="avatar-wrapper">
          <img
            src="{% if profile.profile_image %}{{ profile.profile_image.url }}{% else %}{% static 'diary/default_pfp.png' %}{% endif %}"
            class="avatar"
          >
          <label for="upload-image" class="avatar-edit">ğŸ“·</label>
          <input id="upload-image" type="file" name="profile_image"
                 accept="image/*" onchange="this.form.submit(); showToast('ğŸ“¸ Î— ÎµÎ¹ÎºÏŒÎ½Î± ÎµÎ½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎµ!')">
        </div>
      </form>

      <h2 class="username">{{ user.username }}</h2>
      <p class="email">{{ user.email }}</p>

      <span class="member-chip">
        ğŸ•’ ÎœÎ­Î»Î¿Ï‚ Î±Ï€ÏŒ {{ user.date_joined|date:"d/m/Y" }}
      </span>
    </div>

    <!-- BODY -->
    <div class="profile-body">

      <div class="mood-summary">
        <span class="emoji">
          {% if current_mood == "happy" %}ğŸ˜Š
          {% elif current_mood == "sad" %}ğŸ˜¢
          {% elif current_mood == "angry" %}ğŸ˜¡
          {% elif current_mood == "anxious" %}ğŸ˜°
          {% else %}ğŸ˜{% endif %}
        </span>
        <div>
          <small>Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Î´Î¹Î¬Î¸ÎµÏƒÎ·</small>
          <strong>{{ current_mood|capfirst }}</strong>
        </div>
      </div>

      <div class="achievements">
        <span class="badge">ğŸ† Mood Explorer</span>
      </div>

      <!-- VIEW MODE -->
      <div id="viewMode">
        <div class="info-card">
          ğŸ‚ Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î“Î­Î½Î½Î·ÏƒÎ·Ï‚:
          <strong>{{ profile.Birth_Date|default:"â€”" }}</strong>
        </div>

        <button class="edit-btn" onclick="enableEdit()">âœï¸ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Î ÏÎ¿Ï†Î¯Î»</button>
      </div>

      <form method="POST" id="editMode" class="edit-form" style="display:none;"
            onsubmit="showToast('âœ… Î¤Î¿ Ï€ÏÎ¿Ï†Î¯Î» Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ!')">
        {% csrf_token %}
        <input type="hidden" name="edit_profile" value="1">

        <label>ÎŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î·</label>
        <input type="text" name="username" value="{{ user.username }}">

        <label>Email</label>
        <input type="email" name="email" value="{{ user.email }}">

        <label>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î“Î­Î½Î½Î·ÏƒÎ·Ï‚</label>
        <input type="date" name="birth_date"
               value="{{ profile.Birth_Date|date:'Y-m-d' }}">

        <div class="edit-actions">
          <button type="submit" class="save-btn">ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
          <button type="button" class="cancel-btn" onclick="cancelEdit()">âœ–</button>
        </div>
      </form>

      <!-- ACTIONS -->
      <div class="quick-actions">
        <a href="{% url 'history' %}">ğŸ“œ Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ</a>
        <a href="{% url 'stats' %}">ğŸ“Š Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ¬</a>
      </div>

    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<style>
/* ===== LAYOUT ===== */
.profile-wrapper{
  display:flex;
  justify-content:center;
  padding:60px 0;
}

.profile-card{
  width:400px;
  background:#fff;
  border-radius:30px;
  box-shadow:0 30px 70px rgba(0,0,0,0.18);
  overflow:hidden;
  animation:fadeUp .6s ease;
  font-family:Segoe UI,sans-serif;
}

.profile-header{
  text-align:center;
  padding:42px 20px 30px;
  background:linear-gradient(135deg,#f6e7ef,#fdfbfc);
}

.avatar-wrapper{
  position:relative;
  width:130px;
  height:130px;
  margin:0 auto 15px;
}

.avatar{
  width:130px;
  height:130px;
  border-radius:50%;
  object-fit:cover;
  border:5px solid white;
  box-shadow:0 12px 30px rgba(0,0,0,.25);
}

.avatar-edit{
  position:absolute;
  bottom:8px;
  right:8px;
  width:36px;
  height:36px;
  background:#7b3b65;
  color:white;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

#upload-image{ display:none; }

.email{
  font-size:14px;
  color:#555;
}

.member-chip{
  display:inline-block;
  margin-top:10px;
  padding:6px 16px;
  background:#ececec;
  border-radius:20px;
  font-size:13px;
}

.profile-body{ padding:26px; }

.mood-summary{
  display:flex;
  align-items:center;
  gap:14px;
  background:#f4f0f3;
  padding:16px;
  border-radius:20px;
  margin-bottom:16px;
}

.mood-summary .emoji{ font-size:32px; }

.achievements{
  display:flex;
  justify-content:center;
  margin-bottom:18px;
}

.badge{
  background:#7b3b65;
  color:white;
  padding:7px 16px;
  border-radius:20px;
  font-size:13px;
  font-weight:600;
}

.info-card{
  background:#f6f0f3;
  padding:16px;
  border-radius:20px;
  text-align:center;
  font-weight:600;
}

.edit-btn{
  margin-top:18px;
  width:100%;
  padding:14px;
  border:none;
  border-radius:22px;
  background:#7b3b65;
  color:white;
  font-weight:700;
}

.edit-form label{
  font-size:13px;
  margin-top:12px;
  display:block;
}

.edit-form input{
  width:100%;
  padding:12px;
  border-radius:16px;
  border:1px solid #ccc;
  margin-top:4px;
}

.edit-actions{
  display:flex;
  gap:10px;
  margin-top:16px;
}

.save-btn{
  flex:1;
  background:#7b3b65;
  color:white;
  border:none;
  padding:12px;
  border-radius:20px;
}

.cancel-btn{
  width:48px;
  background:#ddd;
  border:none;
  border-radius:20px;
}

.quick-actions{
  display:flex;
  gap:12px;
  margin-top:24px;
}

.quick-actions a{
  flex:1;
  padding:12px;
  text-align:center;
  background:#f0f0f0;
  border-radius:20px;
  text-decoration:none;
  font-weight:600;
}

.toast{
  position:fixed;
  bottom:30px;
  right:30px;
  background:#7b3b65;
  color:white;
  padding:14px 18px;
  border-radius:18px;
  opacity:0;
  transform:translateY(20px);
  transition:.4s;
}
.toast.show{ opacity:1; transform:none; }

@keyframes fadeUp{
  from{opacity:0; transform:translateY(20px);}
  to{opacity:1; transform:none;}
}
</style>

<script>
function enableEdit(){
  viewMode.style.display="none";
  editMode.style.display="block";
}
function cancelEdit(){
  editMode.style.display="none";
  viewMode.style.display="block";
}
function showToast(msg){
  const t=document.getElementById("toast");
  t.innerText=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2500);
}
</script>

{% endblock %}
