{% extends "diary/base.html" %}
{% load static %}
{% block content %}

<!-- ================= MINI NAVBAR ================= -->
<div class="mini-navbar">
    <div class="left">
        <a href="{% url 'home' %}">ğŸ  Î‘ÏÏ‡Î¹ÎºÎ®</a>
        <a href="{% url 'profile' %}">ğŸ‘¤ Î ÏÎ¿Ï†Î¯Î»</a>
    </div>
    <button class="dark-toggle" onclick="toggleDarkMode()">Dark ModeğŸŒ™</button>
</div>

<div class="page-wrapper mood-{{ current_mood|default:'neutral' }}">

<div class="mood-card fade-in glass">

    <!-- HEADER -->
    <div class="mood-header">
        <span class="step">
            Î•ÏÏÏ„Î·ÏƒÎ· {{ request.session.question_index|add:1 }} / 5
        </span>
        <h2>ÎšÎ±Ï„Î±Î³ÏÎ±Ï†Î® Î”Î¹Î¬Î¸ÎµÏƒÎ·Ï‚</h2>

        <div class="progress-bar">
            <div class="progress-fill step-{{ request.session.question_index|add:1 }}"></div>
        </div>
    </div>

    <div class="chat">
        <div class="bubble bot">
            ğŸ¤– <span id="botText"></span>
        </div>
    </div>

    {% if error %}
        <div class="error-box">âš ï¸ {{ error }}</div>
    {% endif %}

    <!-- FORM -->
    <form method="POST" class="mood-form">
        {% csrf_token %}

        <label class="label">ğŸ“ Î˜ÎµÏ‚ Î½Î± Ï„Î¿ Ï€ÎµÏÎ¹Î³ÏÎ¬ÏˆÎµÎ¹Ï‚;</label>
        <textarea
            name="response"
            rows="5"
            placeholder="Î“ÏÎ¬ÏˆÎµ ÏŒ,Ï„Î¹ ÏƒÎ¿Ï… Î­ÏÏ‡ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ Î¼Ï…Î±Î»ÏŒâ€¦"
            required
        ></textarea>

        <button type="submit" class="btn-next">
            Î£Ï…Î½Î­Ï‡Î¹ÏƒÎµ â†’
        </button>
    </form>

</div>
</div>

<style>
/* ===== PAGE BACKGROUND Î±Î½Î¬ ÏƒÏ…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î± ===== */
.page-wrapper{
    min-height:100vh;
    padding-bottom:60px;
}
.page-wrapper.mood-happy{background:linear-gradient(135deg,#fff4d6,#ffe9a8);}
.page-wrapper.mood-sad{background:linear-gradient(135deg,#e3ecff,#cfdcff);}
.page-wrapper.mood-angry{background:linear-gradient(135deg,#ffe1e1,#ffb3b3);}
.page-wrapper.mood-anxious{background:linear-gradient(135deg,#ede7ff,#d8ccff);}
.page-wrapper.mood-neutral{background:linear-gradient(135deg,#f5f5f5,#ededed);}

/* MINI NAVBAR */
.mini-navbar{
    position:sticky;
    top:90px;
    z-index:40;
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin:20px auto 30px;
    padding:12px 18px;
    max-width:900px;
    border-radius:18px;
    background:rgba(255,255,255,0.75);
    backdrop-filter:blur(12px);
    box-shadow:0 10px 25px rgba(0,0,0,0.15);
}
.mini-navbar a{
    font-weight:700;
    text-decoration:none;
    color:#7b3b65;
}
.dark-toggle{
    border:none;
    background:#7b3b65;
    color:white;
    padding:8px 14px;
    border-radius:14px;
}

/* CARD */
.mood-card{
    width:min(900px,95%);
    margin:0 auto;
    padding:45px;
    border-radius:28px;
    box-shadow:0 20px 45px rgba(0,0,0,0.2);
    font-family:"Segoe UI",sans-serif;
}
.glass{
    background:rgba(255,255,255,0.88);
    backdrop-filter:blur(14px);
}

/* HEADER */
.step{font-size:14px;color:#c86ea3;font-weight:700;}
.mood-header h2{font-size:34px;margin:10px 0;}

/* PROGRESS */
.progress-bar{
    height:8px;
    background:#eee;
    border-radius:8px;
    margin-top:16px;
}
.progress-fill{
    height:100%;
    background:linear-gradient(135deg,#7b3b65,#c86ea3);
}
.step-1{width:20%;}
.step-2{width:40%;}
.step-3{width:60%;}
.step-4{width:80%;}
.step-5{width:100%;}

/* CHAT */
.chat{margin:30px 0;}
.bubble.bot{
    background:linear-gradient(135deg,#7b3b65,#c86ea3);
    color:white;
    padding:20px 24px;
    border-radius:22px;
    font-size:18px;
    max-width:80%;
}

/* BOT IMAGE */
.bot-visual{
    margin:25px 0;
    display:flex;
    justify-content:center;
}
.bot-visual img{
    width:160px;
    border-radius:22px;
    box-shadow:0 12px 30px rgba(0,0,0,.25);
}

/* FORM */
textarea{
    width:100%;
    padding:18px;
    border-radius:18px;
    border:1px solid #ddd;
    font-size:16px;
}
.btn-next{
    width:100%;
    margin-top:22px;
    padding:16px;
    border:none;
    border-radius:20px;
    font-size:19px;
    font-weight:700;
    background:linear-gradient(135deg,#7b3b65,#c86ea3);
    color:white;
}

/* DARK MODE */
body.dark .glass,
body.dark .mini-navbar{background:rgba(35,35,35,0.9);}
body.dark textarea{background:#2f2f2f;color:white;}
body.dark a{color:#f1b6d8;}

/* ANIMATION */
.fade-in{animation:fadeSlide .7s ease;}
@keyframes fadeSlide{
    from{opacity:0;transform:translateY(30px);}
    to{opacity:1;}
}
</style>

<script>
function toggleDarkMode(){
    document.body.classList.toggle("dark");
    localStorage.setItem("dark", document.body.classList.contains("dark"));
}
if(localStorage.getItem("dark")==="true"){
    document.body.classList.add("dark");
}

/* TYPING ANIMATION */
const botMessage = "{{ question|escapejs }}";
const botTextEl = document.getElementById("botText");
let i = 0;

function typeBot(){
    if(i < botMessage.length){
        botTextEl.innerHTML += botMessage.charAt(i);
        i++;
        setTimeout(typeBot, 35);
    }
}
typeBot();
</script>

{% endblock %}
