{% extends "diary/base.html" %}
{% load static %}

{% block content %}

<!-- SIMPLE PAGE NAVBAR -->
<div class="page-navbar">
  <div class="nav-left">
    <a href="{% url 'profile' %}" class="nav-btn">ğŸ‘¤ Î ÏÎ¿Ï†Î¯Î»</a>
    <a href="{% url 'history' %}" class="nav-btn">ğŸ“œ Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ</a>
  </div>

  <div class="nav-right">
    <button class="nav-btn dark-btn" onclick="toggleDarkMode()">ğŸŒ™</button>
  </div>
</div>

<div class="stats-wrapper">

  <h2 class="title">ğŸ“Š Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ¬ Î”Î¹Î¬Î¸ÎµÏƒÎ·Ï‚</h2>
  <form method="get" class="filter-box">
    <div>
      <label>ğŸ“… Î‘Ï€ÏŒ</label>
      <input type="date" name="start_date" value="{{ request.GET.start_date }}">
    </div>
    <div>
      <label>ğŸ“… ÎˆÏ‰Ï‚</label>
      <input type="date" name="end_date" value="{{ request.GET.end_date }}">
    </div>
    <button type="submit">Î¦Î¹Î»Ï„ÏÎ¬ÏÎ¹ÏƒÎ¼Î±</button>
  </form>

  <!-- AVERAGE -->
  <div class="card">
    <h3> ÎœÎ­ÏƒÎ¿Ï‚ ÎŒÏÎ¿Ï‚ ÎˆÎ½Ï„Î±ÏƒÎ·Ï‚</h3>
    {% if avg_score %}
      <p class="avg">{{ avg_score|floatformat:1 }} / 10</p>
    {% else %}
      <p class="empty">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î±.</p>
    {% endif %}
  </div>

  <div class="card">
    <h3>Î£Ï…Ï‡Î½ÏŒÏ„Î·Ï„Î± Î£Ï…Î½Î±Î¹ÏƒÎ¸Î·Î¼Î¬Ï„Ï‰Î½</h3>
    <ul class="mood-list">
      {% for item in mood_counts %}
        <li>
          <span>{{ item.mood }}</span>
          <span class="count">{{ item.total }}</span>
        </li>
      {% empty %}
        <li class="empty">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î­Ï‚.</li>
      {% endfor %}
    </ul>
  </div>

  <!-- HISTORY -->
  <div class="card">
    <h3>ğŸ“œ Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ ÎšÎ±Ï„Î±Î³ÏÎ±Ï†ÏÎ½</h3>
    <table class="history-table">
      <tr>
        <th>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</th>
        <th>Î£Ï…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î±</th>
        <th>Î’Î±Î¸Î¼ÏŒÏ‚</th>
      </tr>

      {% for entry in entries %}
      <tr>
        <td>{{ entry.date|date:"d/m/Y H:i" }}</td>
        <td>{{ entry.mood }}</td>
        <td>{{ entry.score }}/10</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="3" class="empty">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î­Ï‚.</td>
      </tr>
      {% endfor %}
    </table>
  </div>

</div>

<style>
/* PAGE NAVBAR */
.page-navbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:white;
  padding:14px 18px;
  border-radius:18px;
  margin:20px auto 30px;
  max-width:900px;
  box-shadow:0 8px 20px rgba(0,0,0,0.12);
}

.nav-left,
.nav-right{
  display:flex;
  gap:10px;
}

.nav-btn{
  padding:8px 14px;
  border-radius:14px;
  background:#f2f2f2;
  border:none;
  text-decoration:none;
  font-weight:600;
  color:#333;
  cursor:pointer;
}

.dark-btn{
  background:#7b3b65;
  color:white;
}

/* LAYOUT */
.stats-wrapper{
  max-width:900px;
  margin:0 auto 40px;
  font-family:Segoe UI,sans-serif;
}

.title{
  font-size:32px;
  margin-bottom:20px;
  text-align:center;
}

/* FILTER */
.filter-box{
  display:flex;
  gap:15px;
  align-items:end;
  margin-bottom:25px;
  flex-wrap:wrap;
}

.filter-box input{
  padding:8px;
  border-radius:8px;
  border:1px solid #ccc;
}

.filter-box button{
  padding:8px 16px;
  border:none;
  border-radius:10px;
  background:#7b3b65;
  color:white;
  font-weight:600;
}

.card{
  background:white;
  padding:22px;
  border-radius:18px;
  box-shadow:0 8px 20px rgba(0,0,0,0.12);
  margin-bottom:25px;
}

.avg{
  font-size:28px;
  font-weight:700;
  color:#7b3b65;
}

/* MOODS */
.mood-list{
  list-style:none;
  padding:0;
}
.mood-list li{
  display:flex;
  justify-content:space-between;
  padding:8px 0;
}
.count{
  background:#7b3b65;
  color:white;
  padding:4px 10px;
  border-radius:12px;
}

.history-table{
  width:100%;
  border-collapse:collapse;
}
.history-table th,
.history-table td{
  padding:10px;
  border-bottom:1px solid #ddd;
}

.empty{
  color:#888;
  font-style:italic;
  text-align:center;
}

/* DARK MODE */
body.dark{
  background:#1e1e1e;
}

body.dark .page-navbar,
body.dark .card{
  background:#2c2c2c;
  color:#ddd;
}

body.dark .nav-btn{
  background:#3a3a3a;
  color:#ddd;
}

body.dark .dark-btn{
  background:#9e4e79;
}

body.dark table{
  color:#ddd;
}
</style>

<script>
function toggleDarkMode(){
  document.body.classList.toggle("dark");
  localStorage.setItem("dark", document.body.classList.contains("dark"));
}

if(localStorage.getItem("dark")==="true"){
  document.body.classList.add("dark");
}
</script>

{% endblock %}
